!function(){var a=[].slice,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(d,e){var f,g,h;return h="immybox",g={choices:[],blankIfNull:!0,maxResults:50,showArrow:!0,openOnClick:!0,filterFn:function(a){return function(b){return b.text.toLowerCase().indexOf(a.toLowerCase())>=0}},formatChoice:function(b,c){var d,e,f,g,h;return e=b.text.toLowerCase().indexOf(c.toLowerCase()),e>=0?(f=b.text.slice(e,e+c.length),h=b.text.split(f),d=h[0],g=2<=h.length?a.call(h,1):[],""+d+"<span class='highlight'>"+f+"</span>"+g.join(f)):b.text}},f=function(){function a(a,c){this.toggleResults=b(this.toggleResults,this),this.openResults=b(this.openResults,this),this.reposition=b(this.reposition,this),this.revert=b(this.revert,this),this.doSelection=b(this.doSelection,this),this.doQuery=b(this.doQuery,this);var f,i;f=this,this.element=d(a),this.element.addClass(h),this._defaults=g,this._name=h,this.options=d.extend({},g,c),this.choices=this.options.choices,this.selectedChoice=null,this.options.showArrow&&(this.element.addClass(""+h+"_witharrow"),this.downArrow=d("<i class='"+h+"_downarrow icon-chevron-down'></i>"),this.element.after(this.downArrow),this.downArrow.on("click",this.toggleResults)),this.options.openOnClick&&this.element.on("click",this.openResults),this.selectChoiceByValue(this.element.val()),this.queryResultArea=d("<div class='"+h+"_results'></div>"),"function"==typeof(i=this.queryResultArea).scrollLock&&i.scrollLock(),this._val=this.element.val(),this.oldQuery=this._val,this.queryResultArea.on("click","li."+h+"_choice",function(){var a;return a=d(this).data("value"),f.selectChoiceByValue(a),f.hideResults(),f._val=f.element.val(),f.element.focus()}),this.queryResultArea.on("mouseenter","li."+h+"_choice",function(){return f.queryResultArea.find("li."+h+"_choice.active").removeClass("active"),d(this).addClass("active")}),this.element.on("keyup change search",this.doQuery),this.element.on("keydown",this.doSelection),d("body").on("click",this.revert),d(e).on("resize scroll",this.reposition)}return a.prototype.doQuery=function(){var a;return a=this.element.val(),this._val!==a?(this._val=a,this.oldQuery=a,""===a?this.hideResults():this.insertFilteredChoiceElements(a)):void 0},a.prototype.doSelection=function(a){if(27===a.which&&(this.display(),this.hideResults()),this.queryResultArea.is(":visible"))switch(a.which){case 9:return this.selectHighlightedChoice();case 13:return a.preventDefault(),this.selectHighlightedChoice();case 38:return a.preventDefault(),this.highlightPreviousChoice(),this.scroll();case 40:return a.preventDefault(),this.highlightNextChoice(),this.scroll()}else switch(a.which){case 40:return a.preventDefault(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("");case 9:return this.revert()}},a.prototype.revert=function(){return this.queryResultArea.is(":visible")?(this.display(),this.hideResults()):""===this.element.val()?this.selectChoiceByValue(null):void 0},a.prototype.reposition=function(){return this.queryResultArea.is(":visible")?this.positionResultsArea():void 0},a.prototype.openResults=function(a){return a.stopPropagation(),this.revertOtherInstances(),null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("")},a.prototype.toggleResults=function(a){return a.stopPropagation(),this.revertOtherInstances(),this.element.is(":enabled")?(this.queryResultArea.is(":visible")?this.hideResults():null!=this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements(""),this.element.focus()):void 0},a.prototype.insertFilteredChoiceElements=function(a){var b,c,e,f,g,i,j,k=this;return b=""===a?this.choices:this.choices.filter(this.options.filterFn(this.oldQuery)),j=b.slice(0,this.options.maxResults),c=this.options.formatChoice,i=!1,g=j.map(function(b){var e;return e=d("<li class='"+h+"_choice'></li>"),e.attr("data-value",b.value),e.html(c(b,a)),b===k.selectedChoice&&(i=!0,e.addClass("active")),e}),0===g.length?(e=d("<p class='"+h+"_noresults'>no matches</p>"),this.queryResultArea.empty().append(e)):(i||g[0].addClass("active"),f=d("<ul></ul>").append(g),this.queryResultArea.empty().append(f)),this.showResults()},a.prototype.scroll=function(){var a,b,c,d,e,f,g;return f=this.queryResultArea.height(),g=this.queryResultArea.scrollTop(),e=g+f,a=this.getHighlightedChoice(),null==a?!0:(c=a.outerHeight(),d=a.position().top+g,b=d+c,g>d&&this.queryResultArea.scrollTop(d),b>e?this.queryResultArea.scrollTop(b-f):void 0)},a.prototype.positionResultsArea=function(){var a,b,c,f,g,h;return b=this.element.offset(),a=this.element.outerHeight(),c=this.element.outerWidth(),g=this.queryResultArea.outerHeight(),f=b.top+a+g,h=d(e).height()+d(e).scrollTop(),this.queryResultArea.outerWidth(c),this.queryResultArea.css({left:b.left}),f>h?this.queryResultArea.css({top:b.top-g}):this.queryResultArea.css({top:b.top+a})},a.prototype.getHighlightedChoice=function(){var a;return a=this.queryResultArea.find("li."+h+"_choice.active"),1===a.length?a:null},a.prototype.highlightNextChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a&&(b=a.next("li."+h+"_choice"),1===b.length)?(a.removeClass("active"),b.addClass("active")):void 0},a.prototype.highlightPreviousChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a&&(b=a.prev("li."+h+"_choice"),1===b.length)?(a.removeClass("active"),b.addClass("active")):void 0},a.prototype.selectHighlightedChoice=function(){var a,b;return a=this.getHighlightedChoice(),null!=a?(b=a.data("value"),this.selectChoiceByValue(b),this._val=this.element.val(),this.hideResults()):this.revert()},a.prototype.showResults=function(){return d("body").append(this.queryResultArea),this.scroll(),this.positionResultsArea()},a.prototype.hideResults=function(){return this.queryResultArea.detach()},a.prototype.display=function(){return null!=this.selectedChoice?(this.selectedChoice.text,this.element.val(this.selectedChoice.text)):this.options.blankIfNull&&this.element.val(""),this._val=this.element.val()},a.prototype.selectChoiceByValue=function(a){var b,c,d;return d=this.getValue(),null!=a&&""!==a?(b=this.choices.filter(function(b){return b.value==a}),this.selectedChoice=null!=b[0]?b[0]:null):this.selectedChoice=null,c=this.getValue(),c!==d&&this.element.trigger("update",[c]),this.display()},a.prototype.revertOtherInstances=function(){var a;return a=this,d("."+h).each(function(){var b;return b=d.data(this,"plugin_"+h),b!==a?b.revert():void 0})},a.prototype.publicMethods=["getChoices","setChoices","getValue","setValue","destroy"],a.prototype.getChoices=function(){return this.choices},a.prototype.setChoices=function(a){return this.choices=a,null!=this.selectedChoice&&this.selectChoiceByValue(this.selectedChoice.value),this.oldQuery="",a},a.prototype.getValue=function(){return null!=this.selectedChoice?this.selectedChoice.value:null},a.prototype.setValue=function(a){var b;return b=this.getValue(),b!==a?(this.selectChoiceByValue(a),this.oldQuery="",this.getValue()):b},a.prototype.destroy=function(){return this.element.off("keyup change search",this.doQuery),this.element.off("keydown",this.doSelection),this.options.openOnClick&&this.element.off("click",this.openResults),d("body").off("click",this.revert),d(e).off("resize scroll",this.reposition),this.element.removeClass(h),this.options.showArrow&&(this.element.removeClass(""+h+"_witharrow"),this.downArrow.remove()),this.queryResultArea.remove(),d.removeData(this.element[0],"plugin_"+h)},a}(),d.fn[h]=function(a){var b,e;return b=Array.prototype.slice.call(arguments,1),e=[],this.each(function(){var g,i;if(!d.data(this,"plugin_"+h))return e.push(d.data(this,"plugin_"+h,new f(this,a)));if(null!=a&&"string"==typeof a){if(i=d.data(this,"plugin_"+h),g=a,c.call(i.publicMethods,g)>=0)return e.push(i[g].apply(i,b));throw new Error(""+h+" has no method '"+g+"'")}}),e}}(jQuery,window,document)}.call(this);